# æ•°æ®æ´å¯ŸåŠ©æ‰‹ MCP æœåŠ¡é›†æˆé…ç½®
# åŸºäºNVIDIA NeMo Agent Toolkit + MCPæœåŠ¡

general:
  use_uvloop: true

# MCP æœåŠ¡é…ç½®
mcp_servers:
  # AntV å›¾è¡¨ç”ŸæˆæœåŠ¡
  antv_charts:
    command: "npx"
    args: ["@antv/mcp-server-chart"]
    transport: "stdio"
    
  # Excel ä¸“ä¸šå¤„ç†æœåŠ¡
  excel_handler:
    command: "npx"
    args: ["@yzfly/mcp-excel-server"]
    transport: "stdio"
    
  # Pandas æ•°æ®åˆ†ææœåŠ¡
  pandas_analysis:
    command: "python"
    args: ["-m", "pandas_mcp_server"]
    transport: "stdio"

# å‡½æ•°å®šä¹‰ï¼ˆé›†æˆMCPå·¥å…·ï¼‰
functions:
  # åŸºç¡€å·¥å…·
  current_datetime:
    _type: current_datetime
    description: "è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´"
    
  internet_search:
    _type: tavily_internet_search
    description: "ä½¿ç”¨Tavily APIè¿›è¡Œå®æ—¶ç½‘ç»œæœç´¢"

  # MCPé›†æˆçš„æ•°æ®åˆ†æå·¥å…·
  mcp_chart_generator:
    _type: mcp_tool_wrapper
    url: "mcp://antv_charts"
    mcp_tool_name: generate_chart
    description: "ä½¿ç”¨AntVç”Ÿæˆä¸“ä¸šå›¾è¡¨ï¼Œæ”¯æŒ25+ç§å›¾è¡¨ç±»å‹"
    
  mcp_excel_processor:
    _type: mcp_tool_wrapper  
    url: "mcp://excel_handler"
    mcp_tool_name: process_excel
    description: "ä¸“ä¸šExcelæ–‡ä»¶å¤„ç†ï¼Œæ”¯æŒå¤æ‚Excelæ“ä½œ"
    
  mcp_pandas_analysis:
    _type: mcp_tool_wrapper
    url: "mcp://pandas_analysis" 
    mcp_tool_name: analyze_dataframe
    description: "åŸºäºpandasçš„é«˜çº§æ•°æ®åˆ†æåŠŸèƒ½"

  # è‡ªå®šä¹‰æ•°æ®æ´å¯Ÿå·¥å…·
  data_insight_coordinator:
    _type: data_insight_coordinator
    description: "åè°ƒå„ç§æ•°æ®åˆ†æå·¥å…·ï¼Œæä¾›ç»Ÿä¸€çš„æ•°æ®æ´å¯Ÿä½“éªŒ"

# LLM é…ç½®
llms:
  default_llm:
    _type: openai
    model_name: "qwen-plus"
    api_key: "sk-c200bb14290e48bf912ec2dc93b5bc2b"
    base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
    temperature: 0.7
    max_tokens: 2048

# Workflow é…ç½®
workflow:
  _type: react_agent
  tool_names:
    # æ ¸å¿ƒæ•°æ®åˆ†æå·¥å…·ï¼ˆMCPé›†æˆï¼‰
    - mcp_pandas_analysis
    - mcp_chart_generator
    - mcp_excel_processor
    # åè°ƒå·¥å…·
    - data_insight_coordinator
    # è¾…åŠ©å·¥å…·
    - current_datetime
    - internet_search
  llm_name: default_llm
  verbose: true
  parse_agent_response_max_retries: 3
  max_iterations: 20
  
  # æ•°æ®æ´å¯ŸåŠ©æ‰‹ä¸“ç”¨é…ç½®
  additional_instructions: |
    ğŸ” ä½ æ˜¯DASightæ•°æ®æ´å¯ŸåŠ©æ‰‹ï¼ŒåŸºäºNVIDIA NeMo Agent Toolkitæ„å»ºã€‚
    
    ğŸ¯ æ ¸å¿ƒä½¿å‘½ï¼š
    - ä¸“ä¸šçš„CSV/Excelæ•°æ®åˆ†æ
    - æ™ºèƒ½åŒ–æ•°æ®å¯è§†åŒ–
    - æ·±åº¦æ•°æ®æ´å¯Ÿä¸å»ºè®®
    - è‡ªç„¶è¯­è¨€æ•°æ®äº¤äº’
    
    ğŸ› ï¸ å·¥å…·ä½¿ç”¨ç­–ç•¥ï¼š
    1. æ–‡ä»¶å¤„ç†ï¼šä¼˜å…ˆä½¿ç”¨ mcp_excel_processor å¤„ç†Excelï¼Œmcp_pandas_analysis å¤„ç†CSV
    2. æ•°æ®åˆ†æï¼šä½¿ç”¨ mcp_pandas_analysis è¿›è¡Œç»Ÿè®¡åˆ†æå’Œæ•°æ®æ¢ç´¢
    3. å›¾è¡¨ç”Ÿæˆï¼šä½¿ç”¨ mcp_chart_generator (AntV) ç”Ÿæˆä¸“ä¸šå›¾è¡¨
    4. æ•´ä½“åè°ƒï¼šä½¿ç”¨ data_insight_coordinator ç»Ÿä¸€ç®¡ç†åˆ†ææµç¨‹
    
    ğŸ“Š åˆ†ææµç¨‹ï¼š
    1. æ–‡ä»¶ä¸Šä¼  â†’ è‡ªåŠ¨è§£æå’Œé¢„è§ˆ
    2. ç”¨æˆ·æŸ¥è¯¢ â†’ æ™ºèƒ½æ„å›¾è¯†åˆ«  
    3. æ•°æ®åˆ†æ â†’ è°ƒç”¨ç›¸åº”MCPæœåŠ¡
    4. ç»“æœå‘ˆç° â†’ å›¾è¡¨+æ–‡å­—+æ´å¯Ÿ
    
    ğŸ’¡ äº¤äº’åŸåˆ™ï¼š
    - å§‹ç»ˆä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼å‘ˆç°å¤æ‚æ•°æ®åˆ†æç»“æœ
    - ä¸»åŠ¨æä¾›æ•°æ®æ´å¯Ÿå’Œä¸šåŠ¡å»ºè®®
    - æ”¯æŒä¸­æ–‡è‡ªç„¶è¯­è¨€äº¤äº’
    - å‡ºé”™æ—¶æä¾›æ¸…æ™°çš„è§£å†³æ–¹æ¡ˆ
    
    ğŸš€ é«˜çº§åŠŸèƒ½ï¼š
    - è‡ªåŠ¨å›¾è¡¨ç±»å‹æ¨è
    - æ•°æ®è´¨é‡è¯„ä¼°
    - å¼‚å¸¸å€¼æ£€æµ‹å’Œè§£é‡Š
    - è¶‹åŠ¿åˆ†æå’Œé¢„æµ‹å»ºè®®